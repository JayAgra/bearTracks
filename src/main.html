<!DOCTYPE html>
<html lang="en">

<head>
    <title>Match Scouting - 766 Scouting</title>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="language" content="English">
    <meta name="robots" content="index, follow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Scouting">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#121212" id="themeMeta">
    <link rel="stylesheet" href="float.min.css" type="text/css">
    <link rel="manifest" href="/app.webmanifest"/>
    <link rel="apple-touch-startup-image" href="public/launch.png">
    <script src="form.min.js"></script>
    <style>
        .sg {
            grid-column-gap: 10px;
            grid-row-gap: 10px;
            aspect-ratio: 3/1;
            -webkit-column-gap: 10px;
            column-gap: 10px;
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            grid-template-rows: repeat(3, 1fr);
            row-gap: 10px;
            width:100%;
        }

        .sg-c {
            display: flex;
            align-items: center;
            justify-content: center;
            aspect-ratio: 1/1;
            border-radius: 5px;
            font-size: 2rem;
            margin: 2px;
            padding: 2px;
            width:100%;
            background-color: #ddd;
            text-align: center;
            cursor: pointer;
        }

        .sg-c[data-coop=true] {
            background-color: #bbb;
        }
    </style>
</head>

<body class="dark-mode">
    <script>themeHandle()</script>
    <form action="/submit" target="_self" method="POST" name="mainForm" id="mainFormHTML">
        <input type="text" value="main" name="formType" hidden>
        <h1 style="font-family: 'raleway-300'">2023 Scouting<br><span class="gametitle">CHARGED UPâ„ </span></h1><br>
        <h2 class="gameflair1">Pre-Match</h2>
        <fieldset>
            <label>Event Code</label><br>
            <select name="event" id="eventCode">
                <option value="CADA">CADA - Sacramento Regional</option>
                <option value="CASJ" selected>CASJ - Silicon Valley Regional</option>
            </select>
        </fieldset>

        <fieldset>
            <label>Match Number<br></label>
            <input type="tel" name="match" class="smallerInput" required>
            <select name="level">
                <option value="Practice">Practice</option>
                <option value="Qualification" selected>Qual</option>
                <option value="Upper">Upper Bracket</option>
                <option value="Lower">Lower Bracket</option>
            </select>
        </fieldset>

        <fieldset>
            <label>Team Number <span id="invalidTeamInput" style="color: red; display: none;">Not in comp!</span><br></label>
            <input type="tel" name="team" id="validateTeamInput" required>
        </fieldset><br>

        <h2 class="gameflair1">Match Scouting</h2>
        <p id="landscapeReminder" style="display: none; color: red;">Consider turning your device for the grid</p>
        <p>Select only grid squares that the robot you are scouting fills.</p>
        <fieldset>
            <!--INPUT TO SET FOR GRID DATA-->
            <input value="000000000000000000000000000" type="number" name="game12" id="griddata" hidden>
            <br><label><strong class="vstrong">During AUTO, the robot...</strong></label>
            <fieldset>
                <input value="true" type="checkbox" name="game1" class="checkbig"><span>&emsp;Completely left COMMUNITY<br></span><br>
                <input value="true" type="checkbox" name="game2" class="checkbig"><span>&emsp;Scored on a bottom ROW<br></span><br>
                <input value="true" type="checkbox" name="game3" class="checkbig"><span>&emsp;Scored on a middle ROW<br></span><br>
                <input value="true" type="checkbox" name="game4" class="checkbig"><span>&emsp;Scored on a top ROW<br></span><br>
                <input value="0" type="radio" name="game5" class="checkbig" checked="checked"><span>&emsp;Not DOCKED or ENGAGED<br></span><br>
                <input value="8" type="radio" name="game5" class="checkbig"><span>&emsp;DOCKED, not ENGAGED<br></span><br>
                <input value="12" type="radio" name="game5" class="checkbig"><span>&emsp;DOCKED and ENGAGED<br></span><br>
            </fieldset>
            <p><strong>Top of grid</strong></p>
            <div class="sg">
                <!--Grid row 1-->
                <div class="sg-c" data-coop="false" data-num="0" id="sgc_1_1" data-state="0" data-gp="cone"></div>
                <div class="sg-c" data-coop="false" data-num="1" id="sgc_1_2" data-state="0" data-gp="cube"></div>
                <div class="sg-c" data-coop="false" data-num="2" id="sgc_1_3" data-state="0" data-gp="cone"></div>
                <div class="sg-c" data-coop="true" data-num="3" id="sgc_1_4" data-state="0" data-gp="cone"></div>
                <div class="sg-c" data-coop="true" data-num="4" id="sgc_1_5" data-state="0" data-gp="cube"></div>
                <div class="sg-c" data-coop="true" data-num="5" id="sgc_1_6" data-state="0" data-gp="cone"></div>
                <div class="sg-c" data-coop="false" data-num="6" id="sgc_1_7" data-state="0" data-gp="cone"></div>
                <div class="sg-c" data-coop="false" data-num="7" id="sgc_1_8" data-state="0" data-gp="cube"></div>
                <div class="sg-c" data-coop="false" data-num="8" id="sgc_1_9" data-state="0" data-gp="cone"></div>
                <!--Grid row 2-->
                <div class="sg-c" data-coop="false" data-num="9" id="sgc_2_1" data-state="0" data-gp="cone"></div>
                <div class="sg-c" data-coop="false" data-num="10" id="sgc_2_2" data-state="0" data-gp="cube"></div>
                <div class="sg-c" data-coop="false" data-num="11" id="sgc_2_3" data-state="0" data-gp="cone"></div>
                <div class="sg-c" data-coop="true" data-num="12" id="sgc_2_4" data-state="0" data-gp="cone"></div>
                <div class="sg-c" data-coop="true" data-num="13" id="sgc_2_5" data-state="0" data-gp="cube"></div>
                <div class="sg-c" data-coop="true" data-num="14" id="sgc_2_6" data-state="0" data-gp="cone"></div>
                <div class="sg-c" data-coop="false" data-num="15" id="sgc_2_7" data-state="0" data-gp="cone"></div>
                <div class="sg-c" data-coop="false" data-num="16" id="sgc_2_8" data-state="0" data-gp="cube"></div>
                <div class="sg-c" data-coop="false" data-num="17" id="sgc_2_9" data-state="0" data-gp="cone"></div>
                <!--Grid row 3-->
                <div class="sg-c" data-coop="false" data-num="18" id="sgc_3_1" data-state="0" data-gp="h"></div>
                <div class="sg-c" data-coop="false" data-num="19" id="sgc_3_2" data-state="0" data-gp="h"></div>
                <div class="sg-c" data-coop="false" data-num="20" id="sgc_3_3" data-state="0" data-gp="h"></div>
                <div class="sg-c" data-coop="true" data-num="21" id="sgc_3_4" data-state="0" data-gp="h"></div>
                <div class="sg-c" data-coop="true" data-num="22" id="sgc_3_5" data-state="0" data-gp="h"></div>
                <div class="sg-c" data-coop="true" data-num="23" id="sgc_3_6" data-state="0" data-gp="h"></div>
                <div class="sg-c" data-coop="false" data-num="24" id="sgc_3_7" data-state="0" data-gp="h"></div>
                <div class="sg-c" data-coop="false" data-num="25" id="sgc_3_8" data-state="0" data-gp="h"></div>
                <div class="sg-c" data-coop="false" data-num="26" id="sgc_3_9" data-state="0" data-gp="h"></div>
            </div>
            <p><strong>Bottom of grid</strong></p>
        </fieldset>
        <br><label><strong class="vstrong">During TELEOP, the robot...</strong></label>
        <fieldset>
            <input value="true" type="checkbox" name="game6" class="checkbig"><span>&emsp;Scored on a bottom ROW<br></span><br>
            <input value="true" type="checkbox" name="game7" class="checkbig"><span>&emsp;Scored on a middle ROW<br></span><br>
            <input value="true" type="checkbox" name="game8" class="checkbig"><span>&emsp;Scored on a top ROW<br></span><br>
            <input value="true" type="checkbox" name="game9" class="checkbig"><span>&emsp;COOPERTITION bonus<br></span><br>
            <input value="0" type="radio" name="game10" class="checkbig" checked="checked"><span>&emsp;Not DOCKED or ENGAGED<br></span><br>
            <input value="2" type="radio" name="game10" class="checkbig"><span>&emsp;PARKED (in COMMUNITY)<br></span><br>
            <input value="6" type="radio" name="game10" class="checkbig"><span>&emsp;DOCKED and not ENGAGED<br></span><br>
            <input value="10" type="radio" name="game10" class="checkbig"><span>&emsp;DOCKED and ENGAGED<br></span><br>
        </fieldset>

        <!--extra fields to use-->
        <input value="0" type="number" name="game13" hidden>
        <input value="0" type="number" name="game14" hidden>
        <input value="0" type="number" name="game15" hidden>
        <input value="0" type="number" name="game16" hidden>
        <input value="0" type="number" name="game17" hidden>
        <input value="0" type="number" name="game18" hidden>
        <input value="0" type="number" name="game19" hidden>
        <input value="0" type="number" name="game20" hidden>
        <input value="0" type="number" name="game21" hidden>
        <input value="0" type="number" name="game22" hidden>
        <input value="0" type="number" name="game23" hidden>
        <input value="0" type="number" name="game24" hidden>
        <input value="0" type="number" name="game25" hidden>

        <br>
        <h2 class="gameflair1">Post Game</h2>
        <fieldset>
            <label>Estimate the cycle time of the robot <span id="tooLong" style="color: red; display: none;">4 digits or less!</span><br></label><br>
            <input type="tel" name="game11" class="smallerInput" id="validateLength" required> seconds
        </fieldset>
        <fieldset>
            <label>Did the robot play defense? If so, what did they do, and did they get fouls?<br><br></label>
            <textarea rows="2" cols="35" name="defend"></textarea>
        </fieldset>
        <fieldset>
            <label>Thoughts about driving and performance during teleop phase<br><br></label>
            <textarea rows="2" cols="35" name="driving"></textarea>
        </fieldset>
        <fieldset>
            <label>Overall assessment<br><br></label>
            <textarea rows="4" cols="35" name="overall"></textarea>
        </fieldset>
        <br>
        <p style="text-align:center">
            <button type="submit" style="color: #000; background-color: #68C3E2; border-radius: 0.5rem; border-style: solid; border-color: #68C3E2; border-width: 0.875rem; margin-top: 1rem;" id="submitButton">Submit</button><br>
            <button type="button" style="color: #fff; background-color: #E90202; border-radius: 0.5rem; border-style: solid; border-color: #E90202; border-width: 0.875rem; margin-top: 1rem;" onclick="goToHome()">Back</button><br><br>
            <!--<small><button type="button" id="downloadFormButton" onclick="exportSubmissionJSON()" style="color: red; background-color: rgba(0,0,0,0); border: none;">Download Submission</button><a id="downloadFileLink" style="color: green; background-color: rgba(0,0,0,0); text-decoration: none; border: none; display: none;"></a></small><br></small>
            <small><button type="button" id="uploadFormButton" onclick="uploadSubmissionJSON()" style="color: red; background-color: rgba(0,0,0,0); border: none;">Upload Submission</button></small>-->
        </p>
    </form>
    <input type="file" name="jsonScoutFile" accept=".scout" style="display: none;" id="jsonScoutFile" disabled="disabled">
    <br><br>
    <script>
        //data validation
        var allTeams = [];

        async function getEventTeams() {
            const xhr = new XMLHttpRequest();
            xhr.open("GET", `/api/events/${document.getElementById('eventCode').value}/teams`, true);
            xhr.withCredentials = true;

            xhr.onreadystatechange = async () => {
            if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
                console.log("200 ok")
                console.log(xhr.responseText)
                allTeams = (xhr.responseText).split(",")
            } else if (xhr.status === 401) {
                console.log("401 failure")
                window.location.href = "/login";
            } else if (xhr.status === 400) {
                console.log("400 failure")
                document.getElementById("viewNoteButton").innerHTML = "400 Bad Request";
            } else if (xhr.status === 500) {
                console.log("500 failure")
            } else if (xhr.status === 403) {
                console.log("403 failure")
            } else {
                console.log("awaiting response")
            }
            }

            xhr.send()
        }

        getEventTeams()

        document.getElementById('eventCode').addEventListener('change', async function(){console.log(getEventTeams()); console.log(allTeams)});

        document.getElementById('validateTeamInput').addEventListener('input', function(event){
            console.log("event!")
            if (allTeams.includes(document.getElementById('validateTeamInput').value)) {
                document.getElementById('invalidTeamInput').style.display = "none";
                document.getElementById('submitButton').removeAttribute("disabled");
            } else {
                document.getElementById('invalidTeamInput').style.display = "inherit";
                document.getElementById('submitButton').setAttribute("disabled", "disabled");
            }
        });

        document.getElementById('validateLength').addEventListener('input', function(event){
            console.log("event!")
            if ((document.getElementById('validateLength').value).length <= 4) {
                document.getElementById('tooLong').style.display = "none";
                document.getElementById('submitButton').removeAttribute("disabled");
            } else {
                document.getElementById('tooLong').style.display = "inherit";
                document.getElementById('submitButton').setAttribute("disabled", "disabled");
            }
        });
        //end data validation

        //grid orientation reminder
        if (window.innerHeight > window.innerWidth) {
            document.getElementById('landscapeReminder').style.display = "inline";
        }

        window.addEventListener('resize', function(event){
            if(window.innerHeight > window.innerWidth){
                document.getElementById('landscapeReminder').style.display = "inline";
            } else {
                document.getElementById('landscapeReminder').style.display = "none";
            }
        });
        //end grid orientation reminder

        //grid script
        function getAllCells() {
            var cells = [];
            for(let j = 1; j < 4; j++) {
                for(let i = 1; i < 10; i++) {
                    cells.push(document.getElementById('sgc_' + j + '_' + i))
                }
            }
            return cells;
        }
        var sgCellStatus = [
            0, 0, 0,  0, 0, 0,  0, 0, 0,
            0, 0, 0,  0, 0, 0,  0, 0, 0,
            0, 0, 0,  0, 0, 0,  0, 0, 0
        ];
        const allCells = getAllCells();
        function processCellClick(dataNum, numset) {
            sgCellStatus[Number(dataNum)] = numset;
            document.getElementById('griddata').value = sgCellStatus.join('');
            console.log(document.getElementById('griddata').value);
        }
        function setGray(that) {
            that.innerText = "";
            if (that.getAttribute("data-coop") == "true") {
                that.style.background = "#bbb";
            } else {
                that.style.background = "#ddd";
            }
            that.setAttribute("data-state", "0")
            processCellClick(that.getAttribute("data-num"), 0);
        }
        function setSingleCube(that) {
            that.style.background = "#a216a2";
            that.innerText = "";
            that.setAttribute("data-state", "1")
            processCellClick(that.getAttribute("data-num"), 1);
        }
        function setSingleCone(that) {
            that.style.background = "#ff0";
            that.innerText = "";
            that.setAttribute("data-state", "2")
            processCellClick(that.getAttribute("data-num"), 2);
        }
        function setDoubleCube(that) {
            that.style.background = "#a216a2";
            that.style.color = "#ff0";
            that.innerText = "2";
            that.setAttribute("data-state", "3")
            processCellClick(that.getAttribute("data-num"), 3);
        }
        function setDoubleCone(that) {
            that.style.background = "#ff0";
            that.style.color = "#a216a2";
            that.innerText = "2";
            that.setAttribute("data-state", "5")
            processCellClick(that.getAttribute("data-num"), 4);
        }
        for (var i = 0; i < allCells.length; i += 1) {
            allCells[i].addEventListener('click', function (e) {
                if (this.getAttribute("data-gp") === "cube") {
                    if (this.getAttribute("data-state") === "0") {
                        setSingleCube(this);
                    } else if (this.getAttribute("data-state") === "1") {
                        setDoubleCube(this);
                    } else {
                        setGray(this);
                    }
                } else if (this.getAttribute("data-gp") === "cone") {
                    if (this.getAttribute("data-state") === "0") {
                        setSingleCone(this);
                    } else if (this.getAttribute("data-state") === "2") {
                        setDoubleCone(this);
                    } else {
                        setGray(this);
                    }
                } else if (this.getAttribute("data-gp") === "h") {
                    if (this.getAttribute("data-state") === "1") {
                        setSingleCone(this);
                    } else if (this.getAttribute("data-state") === "0") {
                        setSingleCube(this);
                    } else if (this.getAttribute("data-state") === "3") {
                        setDoubleCone(this);
                    } else if (this.getAttribute("data-state") === "2") {
                        setDoubleCube(this);
                    } else {
                        setGray(this);
                    }
                }
            });
        }
        //end grid script
    </script>
</body>
</html>