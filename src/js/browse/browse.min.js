var numberInput=document.getElementById("number"),eventCode=document.getElementById("event"),error=document.getElementById("errorTxt"),searchBtn=document.getElementById("searchBtn");function eV(e){return"true"==e?"✅":"❌"}function callSearch(){search(Number(numberInput.value),eventCode.value,document.getElementById("type").value)}function generateSmallAvgRow(e){return`<tr><td>avg</td><td></td><td>${Math.round(e.auto_charge)}</td><td></td><td>${Math.round(e.teleop_charge)}</td><td>${Math.round(e.grid)}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>${Math.round(e.cycle)}</td><td>${e.perf_score.toFixed(2)}</td></tr>`}async function search(e,t,d="team"){if(e<0||isNaN(e)){numberInput.style.borderColor="var(--cancelColor)";return}var r,a,n,g,o="";"team"===d?(n=`/api/data/current/team/${t}/${e}`,g="team"):(n=`/api/data/current/match/${t}/${e}`,g="match"),searchBtn.innerText="requesting...";try{if(r=await fetch(n,{method:"GET",credentials:"include",redirect:"follow"}),401===r.status||403===r.status){window.location.href="/login";return}if(204===r.status&&(error.innerText="no results",error.style.display="unset"),a=await r.json(),"team"===g){let l={auto_charge:0,teleop_charge:0,grid:0,cycle:0,perf_score:0,lowCube:0,lowCone:0,midCube:0,midCone:0,highCube:0,highCone:0,low:0,mid:0,high:0},c={auto_charge:0,teleop_charge:0,grid:0,cycle:0,perf_score:0},i={auto_charge:Number.MAX_SAFE_INTEGER,teleop_charge:Number.MAX_SAFE_INTEGER,grid:Number.MAX_SAFE_INTEGER,cycle:Number.MAX_SAFE_INTEGER,perf_score:Number.MAX_SAFE_INTEGER};function m(e,t){c[e]<t&&(c[e]=t)}function s(e,t){i[e]>t&&(i[e]=t)}for(var u=0;u<a.length;u++)o+=` <tr><td><a href="/detail?id=${a[u].id}" target="_blank" style="all: unset; color: #2997FF; text-decoration: none;">${a[u].level} ${a[u].match}</a><br><span>${a[u].name} (${a[u].fromTeam})</span></td><td>${eV(a[u].game2)}${eV(a[u].game3)}${eV(a[u].game4)}</td><td>${a[u].game5}</td><td>${eV(a[u].game6)}${eV(a[u].game7)}${eV(a[u].game8)}</td><td>${a[u].game10}</td><td>${a[u].game25}</td><td>${a[u].game21}</td><td>${a[u].game14}</td><td>${a[u].game16}</td><td>${a[u].game13}</td><td>${a[u].game15}</td><td>${a[u].game17}</td><td>${a[u].game18}</td><td>${a[u].game19}</td><td>${a[u].game20}</td><td>${a[u].game11}</td><td>${Number(a[u].weight.split(",")[0]).toFixed(2)}</td></tr>`,l.auto_charge+=Number(a[u].game5),l.teleop_charge+=Number(a[u].game10),l.grid+=Number(a[u].game25),l.cycle+=Number(a[u].game11),l.perf_score+=Number(a[u].weight.split(",")[0]),l.lowCube+=Number(a[u].game21),l.lowCone+=Number(a[u].game13),l.midCube+=Number(a[u].game14),l.midCone+=Number(a[u].game15),l.highCube+=Number(a[u].game16),l.highCone+=Number(a[u].game17),l.low+=Number(a[u].game18),l.mid+=Number(a[u].game19),l.high+=Number(a[u].game20),m("auto_charge",Number(a[u].game5)),m("teleop_charge",Number(a[u].game10)),m("grid",Number(a[u].game25)),m("cycle",Number(a[u].game11)),m("perf_score",Number(a[u].weight.split(",")[0])),s("auto_charge",Number(a[u].game5)),s("teleop_charge",Number(a[u].game10)),s("grid",Number(a[u].game25)),s("cycle",Number(a[u].game11)),s("perf_score",Number(a[u].weight.split(",")[0]));for(let h in l)l[h]/=a.length;for(let y in i)i[y]===Number.MAX_SAFE_INTEGER&&(i[y]="und");o+=`<tr style="font-weight: bold"><td>avg</td><td></td><td>${Math.round(l.auto_charge)} (${i.auto_charge} - ${c.auto_charge})</td><td></td><td>${Math.round(l.teleop_charge)} (${i.teleop_charge} - ${c.teleop_charge})</td><td>${Math.round(l.grid)} (${i.grid} - ${c.grid})</td><td>${Math.round(l.lowCube)}</td><td>${Math.round(l.midCube)}</td><td>${Math.round(l.highCube)}</td><td>${Math.round(l.lowCone)}</td><td>${Math.round(l.midCone)}</td><td>${Math.round(l.highCone)}</td><td>${Math.round(l.low)}</td><td>${Math.round(l.mid)}</td><td>${Math.round(l.high)}</td><td>${Math.round(l.cycle)} (${i.cycle} - ${c.cycle})</td><td>${l.perf_score.toFixed(2)} (${i.perf_score.toFixed(2)} - ${c.perf_score.toFixed(2)})</td></tr>`}else{let p={auto_charge:0,teleop_charge:0,grid:0,cycle:0,perf_score:0};for(var u=0;u<a.length;u++)o+=` <tr><td><strong>Team ${a[u].team}</strong><br><a href="/detail?id=${a[u].id}" target="_blank" style="all: unset; color: #2997FF; text-decoration: none;">${a[u].level} ${a[u].match}</a><br><span>${a[u].name} (${a[u].team})</span></td><td>${eV(a[u].game2)}${eV(a[u].game3)}${eV(a[u].game4)}</td><td>${a[u].game5}</td><td>${eV(a[u].game6)}${eV(a[u].game7)}${eV(a[u].game8)}</td><td>${a[u].game10}</td><td>${a[u].game25}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>${a[u].game11}</td><td>${Number(a[u].weight.split(",")[0]).toFixed(2)}</td></tr>`,p.auto_charge+=Number(a[u].game5),p.teleop_charge+=Number(a[u].game10),p.grid+=Number(a[u].game25),p.cycle+=Number(a[u].game11),p.perf_score+=Number(a[u].weight.split(",")[0]);for(let $ in p)p[$]/=a.length;o+=generateSmallAvgRow(p)}document.getElementById("subheadings").insertAdjacentHTML("afterend",o),document.getElementById("search").style.display="none",document.getElementById("results").style.display="flex"}catch(f){searchBtn.innerText="error",error.innerText="no results",error.style.display="unset",console.error(f)}}async function searchOnLoad(){let e=new URLSearchParams(window.location.search),t=e.get("userId");if(t)try{var d=await fetch(`/api/data/current/scout/${t}`,{method:"GET",credentials:"include",redirect:"follow"});if(401===d.status||403===d.status){window.location.href="/login";return}204===d.status&&(error.innerText="no results",error.style.display="unset");for(var r=await d.json(),a={auto_charge:0,teleop_charge:0,grid:0,cycle:0,perf_score:0},n="",g=0;g<r.length;g++)n+=` <tr><td><strong>Team ${r[g].team}</strong><br><a href="/detail?id=${r[g].id}" target="_blank" style="all: unset; color: #2997FF; text-decoration: none;">${r[g].level} ${r[g].match}</a></td><td>${eV(r[g].game2)}${eV(r[g].game3)}${eV(r[g].game4)}</td><td>${r[g].game5}</td><td>${eV(r[g].game6)}${eV(r[g].game7)}${eV(r[g].game8)}</td><td>${r[g].game10}</td><td>${r[g].game25}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>${r[g].game11}</td><td>${Number(r[g].weight.split(",")[0]).toFixed(2)}</td></tr>`,a.auto_charge+=Number(r[g].game5),a.teleop_charge+=Number(r[g].game10),a.grid+=Number(r[g].game25),a.cycle+=Number(r[g].game11),a.perf_score+=Number(r[g].weight.split(",")[0]);for(let o in a)a[o]/=r.length;n+=generateSmallAvgRow(a),document.getElementById("subheadings").insertAdjacentHTML("afterend",n),document.getElementById("search").style.display="none",document.getElementById("results").style.display="flex"}catch(l){searchBtn.innerText="error",error.innerText="no results",error.style.display="unset",console.error(l)}else e.get("number")&&e.get("event")&&e.get("type")&&search(Number(e.get("number")),e.get("event"),e.get("type"))}document.getElementById("number").addEventListener("keyup",e=>{""!==e.target.value&&(document.getElementById("number").style.borderColor="var(--defaultInputColor)")}),window.addEventListener("keydown",e=>{"Enter"===e.key&&"none"===document.getElementById("results").style.display&&callSearch()});