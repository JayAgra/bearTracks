import{_get as t}from"../_modules/get/get.min.js";import{_dErr as e}from"../_modules/dErr/dErr.min.js";var isPkBtn=!1;let nextBtn=document.getElementById("next"),infoInput=document.getElementById("inputInfo"),currentUsernameInd=document.getElementById("currentUsername"),passwordLoginButton=document.getElementById("pw"),createAccountButton=document.getElementById("createAct"),errorElement=document.getElementById("error"),inputPassword=document.getElementById("inputPassword");function displayErrors(){e(["500 internal server error","invalid credentials","account not yet approved",""])}nextBtn.addEventListener("click",async()=>{if(errorElement.innerText="",isPkBtn){let e;await t("/api/auth/authPasskey/"+setUsername,"error").then(async t=>{e=await SimpleWebAuthnBrowser.startAuthentication(t)}).catch(t=>{throw errorElement.innerText="unknown error getting challenge",Error("unhandled error \uD83D\uDE2D")});let n=await fetch("/api/auth/verifyAuthPasskey/"+setUsername,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=await n.json();r&&r.verified?window.location.href="/":(errorElement.innerText="bad passkey",await new Promise(t=>setTimeout(t,2e3)),window.location.reload())}else{if(0===infoInput.value.length&&""===setUsername){infoInput.classList.add("shakeInput"),await new Promise(t=>setTimeout(t,500)),infoInput.classList.remove("shakeInput");return}infoInput.classList.add("fade"),currentUsernameInd.firstChild.innerText="username",currentUsernameInd.children[1].innerText=infoInput.value,nextBtn.classList.add("nextStepPk"),infoInput.classList.add("fadeIn"),infoInput.placeholder="password",infoInput.setAttribute("autocomplete","current-password"),infoInput.setAttribute("type","password"),passwordLoginButton.style.opacity=0,passwordLoginButton.style.display="",passwordLoginButton.classList.add("nextStepPw"),createAccountButton.classList.add("moveDown"),await new Promise(t=>setTimeout(t,100)),infoInput.style.display="none",inputPassword.style.display="unset",isPkBtn=!0}}),window.displayErrors=displayErrors;