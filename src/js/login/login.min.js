import{_get as e}from"../_modules/get/get.min.js";import{_dErr as t}from"../_modules/dErr/dErr.min.js";var isPkBtn=!1,setUsername="";let nextBtn=document.getElementById("next"),infoInput=document.getElementById("inputInfo"),currentUsernameInd=document.getElementById("currentUsername"),passwordLoginButton=document.getElementById("pw"),createAccountButton=document.getElementById("createAct"),errorElement=document.getElementById("error");function displayErrors(){t(["500 internal server error","invalid credentials","account not yet approved",""])}nextBtn.addEventListener("click",async()=>{if(errorElement.innerText="",isPkBtn){let t;await e("/api/auth/authPasskey/"+setUsername,"error").then(async e=>{t=await SimpleWebAuthnBrowser.startAuthentication(e)}).catch(e=>{throw errorElement.innerText="unknown error getting challenge",Error("unhandled error \uD83D\uDE2D")});let n=await fetch("/api/auth/verifyAuthPasskey/"+setUsername,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await n.json();r&&r.verified?window.location.href="/":(errorElement.innerText="bad passkey",await new Promise(e=>setTimeout(e,2e3)),window.location.reload())}else{if(0===infoInput.value.length){infoInput.classList.add("shakeInput"),await new Promise(e=>setTimeout(e,500)),infoInput.classList.remove("shakeInput");return}infoInput.classList.add("fade"),currentUsernameInd.firstChild.innerText="username",currentUsernameInd.children[1].innerText=infoInput.value,nextBtn.classList.add("nextStepPk"),infoInput.classList.add("fadeIn"),infoInput.placeholder="password",infoInput.setAttribute("autocomplete","current-password"),infoInput.setAttribute("type","password"),setUsername=infoInput.value,infoInput.value="",passwordLoginButton.style.opacity=0,passwordLoginButton.style.display="",passwordLoginButton.classList.add("nextStepPw"),createAccountButton.classList.add("moveDown"),infoInput.id="pwLoginButton",infoInput.reset(),isPkBtn=!0}}),passwordLoginButton.onclick=()=>{document.getElementById("artUsername").value=setUsername,document.getElementById("artPassword").value=infoInput.value,document.getElementById("artForm").submit()},window.displayErrors=displayErrors;