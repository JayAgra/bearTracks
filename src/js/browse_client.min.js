var numberInput=document.getElementById("number"),eventCode=document.getElementById("event"),error=document.getElementById("errorTxt"),searchBtn=document.getElementById("searchBtn");function eV(e){return"true"==e?"✅":"❌"}function callSearch(){search(Number(numberInput.value),eventCode.value,document.getElementById("type").value)}async function search(e,t,d="team"){if(e<0||isNaN(e)){numberInput.style.borderColor="var(--cancelColor)";return}var r,a,o,n,g="";"team"===d?(o=`/api/data/current/team/${t}/${e}`,n="team"):(o=`/api/data/current/match/${t}/${e}`,n="match"),searchBtn.innerText="requesting...";try{if(r=await fetch(o,{method:"GET",credentials:"include",redirect:"follow"}),401===r.status||403===r.status){window.location.href="/login";return}if(204===r.status&&(error.innerText="no results",error.style.display="unset"),a=await r.json(),"team"===n){var l={auto_charge:0,teleop_charge:0,grid:0,cycle:0,perf_score:0,lowCube:0,lowCone:0,midCube:0,midCone:0,highCube:0,highCone:0,low:0,mid:0,high:0},c={auto_charge:0,teleop_charge:0,grid:0,cycle:0,perf_score:0},i={auto_charge:Number.MAX_SAFE_INTEGER,teleop_charge:Number.MAX_SAFE_INTEGER,grid:Number.MAX_SAFE_INTEGER,cycle:Number.MAX_SAFE_INTEGER,perf_score:Number.MAX_SAFE_INTEGER};function s(e,t){c[e]<t&&(c[e]=t)}function m(e,t){i[e]>t&&(i[e]=t)}for(var u=0;u<a.length;u++)g+=` <tr><td><a href="/detail?id=${a[u].id}" target="_blank" style="all: unset; color: #2997FF; text-decoration: none;">${a[u].level} ${a[u].match}</a><br><span>${a[u].discordName}#${a[u].discordTag}</span></td><td>${eV(a[u].game2)}${eV(a[u].game3)}${eV(a[u].game4)}</td><td>${a[u].game5}</td><td>${eV(a[u].game6)}${eV(a[u].game7)}${eV(a[u].game8)}</td><td>${a[u].game10}</td><td>${a[u].game25}</td><td>${a[u].game21}</td><td>${a[u].game14}</td><td>${a[u].game16}</td><td>${a[u].game13}</td><td>${a[u].game15}</td><td>${a[u].game17}</td><td>${a[u].game18}</td><td>${a[u].game19}</td><td>${a[u].game20}</td><td>${a[u].game11}</td><td>${Number(a[u].weight.split(",")[0]).toFixed(2)}</td></tr>`,l.auto_charge+=Number(a[u].game5),l.teleop_charge+=Number(a[u].game10),l.grid+=Number(a[u].game25),l.cycle+=Number(a[u].game11),l.perf_score+=Number(a[u].weight.split(",")[0]),l.lowCube+=Number(a[u].game21),l.lowCone+=Number(a[u].game13),l.midCube+=Number(a[u].game14),l.midCone+=Number(a[u].game15),l.highCube+=Number(a[u].game16),l.highCone+=Number(a[u].game17),l.low+=Number(a[u].game18),l.mid+=Number(a[u].game19),l.high+=Number(a[u].game20),s("auto_charge",a[u].game5),s("teleop_charge",a[u].game10),s("grid",a[u].game25),s("cycle",a[u].game11),s("perf_score",Number(a[u].weight.split(",")[0])),m("auto_charge",a[u].game5),m("teleop_charge",a[u].game10),m("grid",a[u].game25),m("cycle",a[u].game11),m("perf_score",Number(a[u].weight.split(",")[0]));for(let h in l)l[h]/=a.length;for(let y in i)i[y]===Number.MAX_SAFE_INTEGER&&(i[y]="und");g+=`<tr style="font-weight: bold"><td>avg</td><td></td><td>${Math.round(l.auto_charge)} (${i.auto_charge} - ${c.auto_charge})</td><td></td><td>${Math.round(l.teleop_charge)} (${i.teleop_charge} - ${c.teleop_charge})</td><td>${Math.round(l.grid)} (${i.grid} - ${c.grid})</td><td>${Math.round(l.lowCube)}</td><td>${Math.round(l.midCube)}</td><td>${Math.round(l.highCube)}</td><td>${Math.round(l.lowCone)}</td><td>${Math.round(l.midCone)}</td><td>${Math.round(l.highCone)}</td><td>${Math.round(l.low)}</td><td>${Math.round(l.mid)}</td><td>${Math.round(l.high)}</td><td>${Math.round(l.cycle)} (${i.cycle} - ${c.cycle})</td><td>${l.perf_score.toFixed(2)} (${i.perf_score.toFixed(2)} - ${c.perf_score.toFixed(2)})</td></tr>`}else{for(var l={auto_charge:0,teleop_charge:0,grid:0,cycle:0,perf_score:0},u=0;u<a.length;u++)g+=` <tr><td><strong>Team ${a[u].team}</strong><br><a href="/detail?id=${a[u].id}" target="_blank" style="all: unset; color: #2997FF; text-decoration: none;">${a[u].level} ${a[u].match}</a><br><span>${a[u].discordName}#${a[u].discordTag}</span></td><td>${eV(a[u].game2)}${eV(a[u].game3)}${eV(a[u].game4)}</td><td>${a[u].game5}</td><td>${eV(a[u].game6)}${eV(a[u].game7)}${eV(a[u].game8)}</td><td>${a[u].game10}</td><td>${a[u].game25}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>${a[u].game11}</td><td>${Number(a[u].weight.split(",")[0]).toFixed(2)}</td></tr>`,l.auto_charge+=Number(a[u].game5),l.teleop_charge+=Number(a[u].game10),l.grid+=Number(a[u].game25),l.cycle+=Number(a[u].game11),l.perf_score+=Number(a[u].weight.split(",")[0]);for(let p in l)l[p]/=a.length;g+=`<tr><td>avg</td><td></td><td>${Math.round(l.auto_charge)}</td><td></td><td>${Math.round(l.teleop_charge)}</td><td>${Math.round(l.grid)}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>${Math.round(l.cycle)}</td><td>${l.perf_score.toFixed(2)}</td></tr>`}document.getElementById("subheadings").insertAdjacentHTML("afterend",g),document.getElementById("search").style.display="none",document.getElementById("results").style.display="flex"}catch($){searchBtn.innerText="error",error.innerText="no results",error.style.display="unset",console.error($)}}async function searchOnLoad(){let e=new URLSearchParams(window.location.search),t=e.get("discordID");if(t)try{if(response=await fetch(`/api/data/current/scout/${t}`,{method:"GET",credentials:"include",redirect:"follow"}),401===response.status||403===response.status){window.location.href="/login";return}204===response.status&&(error.innerText="no results",error.style.display="unset"),listRes=await response.json();for(var d={auto_charge:0,teleop_charge:0,grid:0,cycle:0,perf_score:0},r="",a=0;a<listRes.length;a++)r+=` <tr><td><strong>Team ${listRes[a].team}</strong><br><a href="/detail?id=${listRes[a].id}" target="_blank" style="all: unset; color: #2997FF; text-decoration: none;">${listRes[a].level} ${listRes[a].match}</a></td><td>${eV(listRes[a].game2)}${eV(listRes[a].game3)}${eV(listRes[a].game4)}</td><td>${listRes[a].game5}</td><td>${eV(listRes[a].game6)}${eV(listRes[a].game7)}${eV(listRes[a].game8)}</td><td>${listRes[a].game10}</td><td>${listRes[a].game25}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>${listRes[a].game11}</td><td>${Number(listRes[a].weight.split(",")[0]).toFixed(2)}</td></tr>`,d.auto_charge+=Number(listRes[a].game5),d.teleop_charge+=Number(listRes[a].game10),d.grid+=Number(listRes[a].game25),d.cycle+=Number(listRes[a].game11),d.perf_score+=Number(listRes[a].weight.split(",")[0]);for(let o in d)d[o]/=listRes.length;r+=`<tr><td>avg</td><td></td><td>${Math.round(d.auto_charge)}</td><td></td><td>${Math.round(d.teleop_charge)}</td><td>${Math.round(d.grid)}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>${Math.round(d.cycle)}</td><td>${d.perf_score.toFixed(2)}</td></tr>`,document.getElementById("subheadings").insertAdjacentHTML("afterend",r),document.getElementById("search").style.display="none",document.getElementById("results").style.display="flex"}catch(n){searchBtn.innerText="error",error.innerText="no results",error.style.display="unset",console.error(n)}else e.get("number")&&e.get("event")&&e.get("type")&&search(e.get("number"),e.get("event"),e.get("type"))}function goToHome(){window.location.href="/"}document.getElementById("number").addEventListener("keyup",e=>{""!==e.target.value&&(document.getElementById("number").style.borderColor="var(--defaultInputColor)")}),window.addEventListener("keydown",e=>{"Enter"===e.key&&"none"===document.getElementById("results").style.display&&callSearch()});