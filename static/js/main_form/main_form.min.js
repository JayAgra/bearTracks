import{_get as e}from"../_modules/get/get.min.js";import{_post as t}from"../_modules/post/post.min.js";var eventMatches,matchesOk=!1;function setBadEvent(){document.getElementById("badEvent").innerHTML="&emsp;no results",document.getElementById("badEvent").style.display="unset",matchesOk=!1}function toLogin(e){(401===e.status||403===e.status)&&(window.location.href="/login")}async function loadMatches(){try{let e=await fetch(`/api/matches/current/${document.getElementById("eventCode").value}/qual/all`,{method:"GET",credentials:"include",redirect:"follow"});if(toLogin(e),204===e.status||!e.ok){setBadEvent();return}eventMatches=await e.json(),matchesOk=!0,document.getElementById("badEvent").style.display="none",matchNumberChange({target:document.getElementById("matchNumberInput")})}catch(t){setBadEvent()}}async function checkLogin(){e("/api/whoami",null).then(e=>{console.log(e)}).catch(e=>console.log(e))}function setOption(e,t){e.value=String(t),e.innerText=String(t)}function matchNumberChange(e){if(matchesOk){let t=document.getElementById("badMatchNum");if(Number(e.target.value)>0&&Number(e.target.value)<=eventMatches.Schedule.length){t.style.display="none",document.getElementById("submitButton").removeAttribute("disabled");let a=eventMatches.Schedule[Number(e.target.value)-1].teams,n=Array.from(document.getElementsByClassName("teamNumOption"));setOption(n[3],a[0].teamNumber),setOption(n[4],a[1].teamNumber),setOption(n[5],a[2].teamNumber),setOption(n[0],a[3].teamNumber),setOption(n[1],a[4].teamNumber),setOption(n[2],a[5].teamNumber)}else t.innerHTML="&emsp;match number must be between 1 and "+eventMatches.Schedule.length,t.style.display="unset",document.getElementById("submitButton").setAttribute("disabled","disabled")}else window.setTimeout(e=>{matchNumberChange(e)},1e3),document.getElementById("submitButton").setAttribute("disabled","disabled")}function validateLengthFn(){let e=document.getElementById("validateLength").value;120>=Number(e)&&Number(e)>=0?(document.getElementById("tooLong").style.display="none",document.getElementById("submitButton").removeAttribute("disabled")):document.getElementById("tooLong").style.display="inherit"}function requiredFormFields(e){String(e.target.value).length>0&&document.getElementById("submitButton").removeAttribute("disabled")}function landscapeReminder(){window.innerHeight>window.innerWidth?document.getElementById("landscapeReminder").style.display="inline":document.getElementById("landscapeReminder").style.display="none"}function checkFormState(){Array.from(document.querySelectorAll("[required]")).forEach(e=>{if(e.value.length<=0)return document.getElementById("submitButton").setAttribute("disabled","disabled"),!1});let e=document.getElementById("validateLength");return!(Number(e)>120&&0>Number(e))&&""!==document.getElementById("teamNumber").value||(document.getElementById("submitButton").setAttribute("disabled","disabled"),!1)}function getAllCells(){var e=[];for(let t=3;t>0;t--)for(let a=9;a>0;a--)document.getElementsByClassName("sg")[0].insertAdjacentHTML("afterbegin",`<div class="sg-c" data-coop="${1===Math.floor((a-1)/3)}" data-num="${26-e.length}" id="sgc_${t}_${a}" data-state="0" data-gp="${3===t?"h":(a+1)%3==0?"cube":"cone"}"></div>`),e.push(document.getElementById("sgc_"+t+"_"+a));return e}window.checkLogin=checkLogin,loadMatches(),validateLengthFn(),document.getElementById("eventCode").addEventListener("change",async()=>{await loadMatches()}),document.getElementById("matchNumberInput").addEventListener("input",e=>{matchNumberChange(e)}),document.getElementById("validateLength").addEventListener("input",()=>{validateLengthFn()}),Array.from(document.querySelectorAll("[required]")).forEach(e=>{e.addEventListener("input",e=>{requiredFormFields(e)})}),window.addEventListener("resize",landscapeReminder),window.checkFormState=checkFormState,setInterval(checkFormState,2e3);var sgCellStatus=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];let allCells=getAllCells();function processCellClick(e,t){sgCellStatus[Number(e)]=t,document.getElementById("griddata").value=sgCellStatus.join(""),console.log(document.getElementById("griddata").value)}function setGray(e){e.innerText="","true"==e.getAttribute("data-coop")?e.style.background="#bbb":e.style.background="#ddd",e.setAttribute("data-state","0"),processCellClick(e.getAttribute("data-num"),0)}function setThat(e,t,a,n,l,s){e.style.background=t,e.style.color=s,e.innerText=a,e.setAttribute("data-state",n),processCellClick(e.getAttribute("data-num"),l)}function setSingleCube(e){setThat(e,"#a216a2","","1",1,"#ff0")}function setSingleCone(e){setThat(e,"#ff0","","2",2,"#a216a2")}function setDoubleCube(e){setThat(e,"#a216a2","2","3",3,"#ff0")}function setDoubleCone(e){setThat(e,"#ff0","2","5",4,"#a216a2")}for(var i=0;i<allCells.length;i+=1)allCells[i].addEventListener("click",function(){"cube"===this.getAttribute("data-gp")?"0"===this.getAttribute("data-state")?setSingleCube(this):"1"===this.getAttribute("data-state")?setDoubleCube(this):setGray(this):"cone"===this.getAttribute("data-gp")?"0"===this.getAttribute("data-state")?setSingleCone(this):"2"===this.getAttribute("data-state")?setDoubleCone(this):setGray(this):"h"===this.getAttribute("data-gp")&&("1"===this.getAttribute("data-state")?setSingleCone(this):"0"===this.getAttribute("data-state")?setSingleCube(this):"3"===this.getAttribute("data-state")?setDoubleCone(this):"2"===this.getAttribute("data-state")?setDoubleCube(this):setGray(this))});async function post(e,t){let a=await fetch(e,{method:"POST",cache:"no-cache",credentials:"include",headers:{"Content-Type":"application/json"},redirect:"follow",body:JSON.stringify(t)});return a.json()}function mainFormError(e){document.getElementById("submitText_d").innerText="ERROR!!!",document.getElementById("submitProgress_d").value=0,document.getElementById("reSubmitButton").style.display="unset",console.error(e)}async function uploadForm(){if(!checkFormState()){alert("there are issues with your form");return}let a={season:2023,event:document.getElementsByName("event")[0].value,match_num:Number(document.getElementsByName("match")[0].value),level:document.getElementsByName("level")[0].value,team:Number(document.getElementsByName("team")[0].value),game:[document.getElementsByName("game1")[0].value,document.getElementsByName("game2")[0].value,document.getElementsByName("game3")[0].value,document.getElementsByName("game4")[0].value,document.getElementsByName("game5")[0].value,document.getElementsByName("game6")[0].value,document.getElementsByName("game7")[0].value,document.getElementsByName("game8")[0].value,document.getElementsByName("game9")[0].value,document.getElementsByName("game10")[0].value,document.getElementsByName("game11")[0].value,document.getElementsByName("game12")[0].value,document.getElementsByName("game13")[0].value,document.getElementsByName("game14")[0].value,document.getElementsByName("game15")[0].value,document.getElementsByName("game16")[0].value,document.getElementsByName("game17")[0].value,document.getElementsByName("game18")[0].value,document.getElementsByName("game19")[0].value,document.getElementsByName("game20")[0].value,document.getElementsByName("game21")[0].value,document.getElementsByName("game22")[0].value,document.getElementsByName("game23")[0].value,document.getElementsByName("game24")[0].value,document.getElementsByName("game25")[0].value,].join(","),defend:document.getElementsByName("defend")[0].value,driving:document.getElementsByName("driving")[0].value,overall:document.getElementsByName("overall")[0].value};document.getElementById("mainFormHTML").style.display="none",document.getElementById("submitUi").style.display="unset",document.getElementById("reSubmitButton").style.display="none";let n=document.getElementById("submitText_d"),l=document.getElementById("submitProgress_d");await new Promise(e=>setTimeout(e,250)),t("/api/v1/data/submit",n.id,a).then(async t=>{console.log(t.id),n.innerText="Verifying...",await new Promise(e=>setTimeout(e,250)),e(`/api/v1/data/exists/${t.id}`,document.getElementById("submitText_d").id).then(async e=>{e.team==a.team&&e.match_num==a.match_num?(n.innerText="Done!",l.value=100,l.max=100,await new Promise(e=>setTimeout(e,1500)),window.location.href="/"):mainFormError("data mismatch")}).catch(e=>{mainFormError(e)})}).catch(e=>{mainFormError(e)})}window.uploadForm=uploadForm;