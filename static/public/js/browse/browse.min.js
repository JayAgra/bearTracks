import{_get as e}from"../_modules/get/get.min.js";var numberInput=document.getElementById("number"),eventCode=document.getElementById("event"),error=document.getElementById("errorTxt"),searchBtn=document.getElementById("searchBtn");function eV(e){return"true"==e?"✅":"❌"}function callSearch(){search(Number(numberInput.value),eventCode.value,document.getElementById("type").value)}function generateSmallAvgRow(e){return`<tr><td>avg</td><td></td><td>${Math.round(e.auto_charge)}</td><td></td><td>${Math.round(e.teleop_charge)}</td><td>${Math.round(e.grid)}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>${Math.round(e.cycle)}</td><td>${e.perf_score.toFixed(2)}</td></tr>`}async function search(t,d,r="team"){if(t<0||isNaN(t)){numberInput.style.borderColor="var(--cancelColor)";return}var n,a="";n="team"===r?`/api/v1/data/brief/team/${new Date().getFullYear()}/${d}/${t}`:`/api/v1/data/brief/match/${new Date().getFullYear()}/${d}/${t}`,searchBtn.innerText="requesting...",e(n,searchBtn.id).then(e=>{if(0===e.length){searchBtn.innerText="no results";return}if("team"===r){let t={auto_charge:0,teleop_charge:0,grid:0,cycle:0,perf_score:0,lowCube:0,lowCone:0,midCube:0,midCone:0,highCube:0,highCone:0,low:0,mid:0,high:0},d={auto_charge:0,teleop_charge:0,grid:0,cycle:0,perf_score:0},n={auto_charge:Number.MAX_SAFE_INTEGER,teleop_charge:Number.MAX_SAFE_INTEGER,grid:Number.MAX_SAFE_INTEGER,cycle:Number.MAX_SAFE_INTEGER,perf_score:Number.MAX_SAFE_INTEGER};function l(e,t){d[e]<t&&(d[e]=t)}function o(e,t){n[e]>t&&(n[e]=t)}for(var i=0;i<e.length;i++){let c=e[i].Brief.game.split(",");a+=` <tr><td><a href="/detail?id=${e[i].Brief.id}" target="_blank" style="all: unset; color: #2997FF; text-decoration: none;">qual ${e[i].Brief.match_num}</a><br><span>${e[i].Brief.name} (${e[i].Brief.from_team})</span></td><td>${eV(c[1])}${eV(c[2])}${eV(c[3])}</td><td>${c[4]}</td><td>${eV(c[5])}${eV(c[6])}${eV(c[7])}</td><td>${c[9]}</td><td>${c[24]}</td><td>${c[20]}</td><td>${c[13]}</td><td>${c[15]}</td><td>${c[12]}</td><td>${c[14]}</td><td>${c[16]}</td><td>${c[17]}</td><td>${c[18]}</td><td>${c[19]}</td><td>${c[10]}</td><td>${Number(e[i].Brief.weight.split(",")[0]).toFixed(2)}</td></tr>`,t.auto_charge+=Number(c[4]),t.teleop_charge+=Number(c[9]),t.grid+=Number(c[24]),t.cycle+=Number(c[10]),t.perf_score+=Number(e[i].Brief.weight.split(",")[0]),t.lowCube+=Number(c[20]),t.lowCone+=Number(c[12]),t.midCube+=Number(c[13]),t.midCone+=Number(c[14]),t.highCube+=Number(c[15]),t.highCone+=Number(c[16]),t.low+=Number(c[17]),t.mid+=Number(c[18]),t.high+=Number(c[18]),l("auto_charge",Number(c[4])),l("teleop_charge",Number(c[9])),l("grid",Number(c[24])),l("cycle",Number(c[10])),l("perf_score",Number(e[i].Brief.weight.split(",")[0])),o("auto_charge",Number(c[4])),o("teleop_charge",Number(c[9])),o("grid",Number(c[24])),o("cycle",Number(c[10])),o("perf_score",Number(e[i].Brief.weight.split(",")[0]))}for(let g in t)t[g]/=e.length;for(let h in n)n[h]===Number.MAX_SAFE_INTEGER&&(n[h]="und");a+=`<tr style="font-weight: bold"><td>avg</td><td></td><td>${Math.round(t.auto_charge)} (${n.auto_charge} - ${d.auto_charge})</td><td></td><td>${Math.round(t.teleop_charge)} (${n.teleop_charge} - ${d.teleop_charge})</td><td>${Math.round(t.grid)} (${n.grid} - ${d.grid})</td><td>${Math.round(t.lowCube)}</td><td>${Math.round(t.midCube)}</td><td>${Math.round(t.highCube)}</td><td>${Math.round(t.lowCone)}</td><td>${Math.round(t.midCone)}</td><td>${Math.round(t.highCone)}</td><td>${Math.round(t.low)}</td><td>${Math.round(t.mid)}</td><td>${Math.round(t.high)}</td><td>${Math.round(t.cycle)} (${n.cycle} - ${d.cycle})</td><td>${t.perf_score.toFixed(2)} (${n.perf_score.toFixed(2)} - ${d.perf_score.toFixed(2)})</td></tr>`}else{let s={auto_charge:0,teleop_charge:0,grid:0,cycle:0,perf_score:0};for(var i=0;i<e.length;i++){let u=e[i].Brief.game.split(",");a+=` <tr><td><strong>Team ${e[i].Brief.team}</strong><br><a href="/detail?id=${e[i].Brief.id}" target="_blank" style="all: unset; color: #2997FF; text-decoration: none;">qual ${e[i].Brief.match_num}</a><br><span>${e[i].Brief.name} (${e[i].Brief.team})</span></td><td>${eV(u[1])}${eV(u[2])}${eV(u[3])}</td><td>${u[4]}</td><td>${eV(u[5])}${eV(u[6])}${eV(u[7])}</td><td>${u[9]}</td><td>${u[24]}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>${u[10]}</td><td>${Number(e[i].Brief.weight.split(",")[0]).toFixed(2)}</td></tr>`,s.auto_charge+=Number(u[4]),s.teleop_charge+=Number(u[9]),s.grid+=Number(u[24]),s.cycle+=Number(u[10]),s.perf_score+=Number(e[i].Brief.weight.split(",")[0])}for(let f in s)s[f]/=e.length;a+=generateSmallAvgRow(s)}document.getElementById("subheadings").insertAdjacentHTML("afterend",a),document.getElementById("search").style.display="none",document.getElementById("results").style.display="flex"}).catch(e=>console.log(e))}async function searchOnLoad(){let t=new URLSearchParams(window.location.search),d=t.get("userId");d?e(`/api/v1/data/user/${new Date().getFullYear()}/${d}`,error.id).then(e=>{if(0===e.length){searchBtn.innerText="no results";return}for(var t={auto_charge:0,teleop_charge:0,grid:0,cycle:0,perf_score:0},d="",r=0;r<e.length;r++){let n=e[r].game.split(",");d+=` <tr><td><strong>Team ${e[r].team}</strong><br><a href="/detail?id=${e[r].id}" target="_blank" style="all: unset; color: #2997FF; text-decoration: none;">qual ${e[r].match_num}</a></td><td>${eV(n[1])}${eV(n[2])}${eV(n[3])}</td><td>${n[4]}</td><td>${eV(n[5])}${eV(n[6])}${eV(n[7])}</td><td>${n[9]}</td><td>${n[24]}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>${n[10]}</td><td>${Number(e[r].weight.split(",")[0]).toFixed(2)}</td></tr>`,t.auto_charge+=Number(n[4]),t.teleop_charge+=Number(n[9]),t.grid+=Number(n[24]),t.cycle+=Number(n[10]),t.perf_score+=Number(e[r].weight.split(",")[0])}for(let a in t)t[a]/=e.length;d+=generateSmallAvgRow(t),document.getElementById("subheadings").insertAdjacentHTML("afterend",d),document.getElementById("search").style.display="none",document.getElementById("results").style.display="flex"}).catch(e=>console.log(e)):t.get("number")&&t.get("event")&&t.get("type")&&search(Number(t.get("number")),t.get("event"),t.get("type"))}window.callSearch=callSearch,window.searchOnLoad=searchOnLoad,window.search=search,document.getElementById("number").addEventListener("keyup",e=>{""!==e.target.value&&(document.getElementById("number").style.borderColor="var(--defaultInputColor)")}),window.addEventListener("keydown",e=>{"Enter"===e.key&&"none"===document.getElementById("results").style.display&&callSearch()});