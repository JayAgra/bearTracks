import{_get as t}from"../_modules/get/get.min.js";var numberInput=document.getElementById("number"),eventCode=document.getElementById("event"),error=document.getElementById("errorTxt"),searchBtn=document.getElementById("searchBtn");function eV(t){return"true"==t?"✅":"❌"}function callSearch(){search(Number(numberInput.value),eventCode.value,document.getElementById("type").value)}function generateSmallAvgRow(t){return`<tr><td>avg</td><td></td><td>${Math.round(t.auto_charge)}</td><td></td><td>${Math.round(t.teleop_charge)}</td><td>${Math.round(t.grid)}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>${Math.round(t.cycle)}</td><td>${t.perf_score.toFixed(2)}</td></tr>`}async function search(e,d,r="team"){if(e<0||isNaN(e)){numberInput.style.borderColor="var(--cancelColor)";return}var a,n,l="";"team"===r?(a=`/api/v1/data/brief/team/${new Date().getFullYear()}/${d}/${e}`,n="team"):(a=`/api/v1/data/brief/match/${new Date().getFullYear()}/${d}/${e}`,n="match"),searchBtn.innerText="requesting...",t(a,searchBtn.id).then(t=>{if(0===t.length){searchBtn.innerText="no results";return}if("team"===n){let e={auto_charge:0,teleop_charge:0,grid:0,cycle:0,perf_score:0,lowCube:0,lowCone:0,midCube:0,midCone:0,highCube:0,highCone:0,low:0,mid:0,high:0},d={auto_charge:0,teleop_charge:0,grid:0,cycle:0,perf_score:0},r={auto_charge:Number.MAX_SAFE_INTEGER,teleop_charge:Number.MAX_SAFE_INTEGER,grid:Number.MAX_SAFE_INTEGER,cycle:Number.MAX_SAFE_INTEGER,perf_score:Number.MAX_SAFE_INTEGER};function a(t,e){d[t]<e&&(d[t]=e)}function o(t,e){r[t]>e&&(r[t]=e)}for(var c=0;c<t.length;c++){let g=t[c].game.split(",");l+=` <tr><td><a href="/detail?id=${t[c].id}" target="_blank" style="all: unset; color: #2997FF; text-decoration: none;">qual ${t[c].match_num}</a><br><span>${t[c].name} (${t[c].from_team})</span></td><td>${eV(g[1])}${eV(g[2])}${eV(g[3])}</td><td>${g[4]}</td><td>${eV(g[5])}${eV(g[6])}${eV(g[7])}</td><td>${g[9]}</td><td>${g[24]}</td><td>${g[20]}</td><td>${g[13]}</td><td>${g[15]}</td><td>${g[12]}</td><td>${g[14]}</td><td>${g[16]}</td><td>${g[17]}</td><td>${g[18]}</td><td>${g[19]}</td><td>${g[10]}</td><td>${Number(t[c].weight.split(",")[0]).toFixed(2)}</td></tr>`,e.auto_charge+=Number(g[4]),e.teleop_charge+=Number(g[9]),e.grid+=Number(g[24]),e.cycle+=Number(g[10]),e.perf_score+=Number(t[c].weight.split(",")[0]),e.lowCube+=Number(g[20]),e.lowCone+=Number(g[12]),e.midCube+=Number(g[13]),e.midCone+=Number(g[14]),e.highCube+=Number(g[15]),e.highCone+=Number(g[16]),e.low+=Number(g[17]),e.mid+=Number(g[18]),e.high+=Number(g[18]),a("auto_charge",Number(g[4])),a("teleop_charge",Number(g[9])),a("grid",Number(g[24])),a("cycle",Number(g[10])),a("perf_score",Number(t[c].weight.split(",")[0])),o("auto_charge",Number(g[4])),o("teleop_charge",Number(g[9])),o("grid",Number(g[24])),o("cycle",Number(g[10])),o("perf_score",Number(t[c].weight.split(",")[0]))}for(let i in e)e[i]/=t.length;for(let h in r)r[h]===Number.MAX_SAFE_INTEGER&&(r[h]="und");l+=`<tr style="font-weight: bold"><td>avg</td><td></td><td>${Math.round(e.auto_charge)} (${r.auto_charge} - ${d.auto_charge})</td><td></td><td>${Math.round(e.teleop_charge)} (${r.teleop_charge} - ${d.teleop_charge})</td><td>${Math.round(e.grid)} (${r.grid} - ${d.grid})</td><td>${Math.round(e.lowCube)}</td><td>${Math.round(e.midCube)}</td><td>${Math.round(e.highCube)}</td><td>${Math.round(e.lowCone)}</td><td>${Math.round(e.midCone)}</td><td>${Math.round(e.highCone)}</td><td>${Math.round(e.low)}</td><td>${Math.round(e.mid)}</td><td>${Math.round(e.high)}</td><td>${Math.round(e.cycle)} (${r.cycle} - ${d.cycle})</td><td>${e.perf_score.toFixed(2)} (${r.perf_score.toFixed(2)} - ${d.perf_score.toFixed(2)})</td></tr>`}else{let s={auto_charge:0,teleop_charge:0,grid:0,cycle:0,perf_score:0};for(var c=0;c<t.length;c++){let u=t[c].game.split(",");l+=` <tr><td><strong>Team ${t[c].team}</strong><br><a href="/detail?id=${t[c].id}" target="_blank" style="all: unset; color: #2997FF; text-decoration: none;">qual ${t[c].match_num}</a><br><span>${t[c].name} (${t[c].team})</span></td><td>${eV(u[1])}${eV(u[2])}${eV(u[3])}</td><td>${u[4]}</td><td>${eV(u[5])}${eV(u[6])}${eV(u[7])}</td><td>${u[9]}</td><td>${u[24]}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>${u[10]}</td><td>${Number(t[c].weight.split(",")[0]).toFixed(2)}</td></tr>`,s.auto_charge+=Number(u[4]),s.teleop_charge+=Number(u[9]),s.grid+=Number(u[24]),s.cycle+=Number(u[10]),s.perf_score+=Number(t[c].weight.split(",")[0])}for(let m in s)s[m]/=t.length;l+=generateSmallAvgRow(s)}document.getElementById("subheadings").insertAdjacentHTML("afterend",l),document.getElementById("search").style.display="none",document.getElementById("results").style.display="flex"}).catch(t=>console.log(t))}async function searchOnLoad(){let e=new URLSearchParams(window.location.search),d=e.get("userId");d?t(`/api/v1/data/user/${new Date().getFullYear()}/${d}`,error.id).then(t=>{if(0===t.length){searchBtn.innerText="no results";return}for(var e={auto_charge:0,teleop_charge:0,grid:0,cycle:0,perf_score:0},d="",r=0;r<t.length;r++){let a=t[r].game.split(",");d+=` <tr><td><strong>Team ${t[r].team}</strong><br><a href="/detail?id=${t[r].id}" target="_blank" style="all: unset; color: #2997FF; text-decoration: none;">qual ${t[r].match_num}</a></td><td>${eV(a[1])}${eV(a[2])}${eV(a[3])}</td><td>${a[4]}</td><td>${eV(a[5])}${eV(a[6])}${eV(a[7])}</td><td>${a[9]}</td><td>${a[24]}</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>${a[10]}</td><td>${Number(t[r].weight.split(",")[0]).toFixed(2)}</td></tr>`,e.auto_charge+=Number(a[4]),e.teleop_charge+=Number(a[9]),e.grid+=Number(a[24]),e.cycle+=Number(a[10]),e.perf_score+=Number(t[r].weight.split(",")[0])}for(let n in e)e[n]/=t.length;d+=generateSmallAvgRow(e),document.getElementById("subheadings").insertAdjacentHTML("afterend",d),document.getElementById("search").style.display="none",document.getElementById("results").style.display="flex"}).catch(t=>console.log(t)):e.get("number")&&e.get("event")&&e.get("type")&&search(Number(e.get("number")),e.get("event"),e.get("type"))}window.callSearch=callSearch,window.searchOnLoad=searchOnLoad,window.search=search,document.getElementById("number").addEventListener("keyup",t=>{""!==t.target.value&&(document.getElementById("number").style.borderColor="var(--defaultInputColor)")}),window.addEventListener("keydown",t=>{"Enter"===t.key&&"none"===document.getElementById("results").style.display&&callSearch()});