import{_get as e}from"../_modules/get/get.min.js";import{_post as t}from"../_modules/post/post.min.js";var eventMatches,matchesOk=!1;function setBadEvent(){document.getElementById("badEvent").innerHTML="&emsp;no results",document.getElementById("badEvent").style.display="unset",matchesOk=!1}function toLogin(e){(401===e.status||403===e.status)&&(window.location.href="/login")}async function loadMatches(){try{let e=await fetch(`/api/v1/events/matches/2023/${document.getElementById("eventCode").value}/qual/all`,{method:"GET",credentials:"include",redirect:"follow"});if(toLogin(e),204===e.status||!e.ok)return setBadEvent();eventMatches=await e.json(),matchesOk=!0,document.getElementById("badEvent").style.display="none",matchNumberChange({target:document.getElementById("matchNumberInput")})}catch(t){setBadEvent()}}async function checkLogin(){e("/api/v1/whoami",null).then(e=>{console.log(e)}).catch(e=>console.log(e))}function setOption(e,t){e.value=String(t),e.innerText=String(t)}function matchNumberChange(e){if(matchesOk){let t=document.getElementById("badMatchNum");if(Number(e.target.value)>0&&Number(e.target.value)<=eventMatches.Schedule.length){t.style.display="none",document.getElementById("submitButton").removeAttribute("disabled");let a=eventMatches.Schedule[Number(e.target.value)-1].teams,n=Array.from(document.getElementsByClassName("teamNumOption"));setOption(n[3],a[0].teamNumber),setOption(n[4],a[1].teamNumber),setOption(n[5],a[2].teamNumber),setOption(n[0],a[3].teamNumber),setOption(n[1],a[4].teamNumber),setOption(n[2],a[5].teamNumber)}else t.innerHTML="&emsp;match number must be between 1 and "+eventMatches.Schedule.length,t.style.display="unset",document.getElementById("submitButton").setAttribute("disabled","disabled")}else window.setTimeout(e=>{matchNumberChange(e)},1e3),document.getElementById("submitButton").setAttribute("disabled","disabled")}function validateLengthFn(){let e=document.getElementById("validateLength").value;120>=Number(e)&&Number(e)>=0?(document.getElementById("tooLong").style.display="none",document.getElementById("submitButton").removeAttribute("disabled")):document.getElementById("tooLong").style.display="inherit"}function requiredFormFields(e){String(e.target.value).length>0&&document.getElementById("submitButton").removeAttribute("disabled")}function checkFormState(){Array.from(document.querySelectorAll("[required]")).forEach(e=>{if(e.value.length<=0)return document.getElementById("submitButton").setAttribute("disabled","disabled"),!1});let e=document.getElementById("validateLength");return!(Number(e)>120&&0>Number(e))&&""!==document.getElementById("teamNumber").value||(document.getElementById("submitButton").setAttribute("disabled","disabled"),!1)}window.checkLogin=checkLogin,loadMatches(),validateLengthFn(),document.getElementById("eventCode").addEventListener("change",async()=>{await loadMatches()}),document.getElementById("matchNumberInput").addEventListener("input",e=>{matchNumberChange(e)}),document.getElementById("validateLength").addEventListener("input",()=>{validateLengthFn()}),Array.from(document.querySelectorAll("[required]")).forEach(e=>{e.addEventListener("input",e=>{requiredFormFields(e)})}),window.checkFormState=checkFormState,setInterval(checkFormState,2e3);var up_arrows=Array.from(document.getElementsByClassName("sg-c up")),count_cells=Array.from(document.getElementsByClassName("sg-c counter")),down_arrows=Array.from(document.getElementsByClassName("sg-c down")),values=[0,0,0];function up_arrow_click(e){let t=Number(e.target.id.substring(3));values[t]++,count_cells[t].firstChild.innerText=String(values[t])}function down_arrow_click(e){let t=Number(e.target.id.substring(3));values[t]>0&&values[t]--,count_cells[t].firstChild.innerText=String(values[t])}function mainFormError(e){document.getElementById("submitText_d").innerText="ERROR!!!",document.getElementById("submitProgress_d").value=0,document.getElementById("reSubmitButton").style.display="unset",console.error(e)}async function uploadForm(){if(!checkFormState()){alert("there are issues with your form");return}let a={season:2024,event:document.getElementsByName("event")[0].value,match_num:Number(document.getElementsByName("match")[0].value),level:document.getElementsByName("level")[0].value,team:Number(document.getElementsByName("team")[0].value),game:[document.getElementsByName("game1")[0].value,document.getElementsByName("game2")[0].value,document.getElementsByName("game3")[0].value,values[0],values[1],values[2],document.getElementsByName("game7")[0].value,document.getElementsByName("game8")[0].value,document.getElementsByName("game9")[0].value,document.getElementsByName("game10")[0].value,document.getElementsByName("game11")[0].value,document.getElementsByName("game12")[0].value].join(","),defend:document.getElementsByName("defend")[0].value,driving:document.getElementsByName("driving")[0].value,overall:document.getElementsByName("overall")[0].value};document.getElementById("mainFormHTML").style.display="none",document.getElementById("submitUi").style.display="unset",document.getElementById("reSubmitButton").style.display="none";let n=document.getElementById("submitText_d"),l=document.getElementById("submitProgress_d");await new Promise(e=>setTimeout(e,250)),t("/api/v1/data/submit",n.id,a).then(async t=>{console.log(t.id),n.innerText="Verifying...",await new Promise(e=>setTimeout(e,250)),e(`/api/v1/data/exists/${t.id}`,document.getElementById("submitText_d").id).then(async e=>{e[0].Exists.team==a.team&&e[0].Exists.match_num==a.match_num?(n.innerText="Done!",l.value=100,l.max=100,await new Promise(e=>setTimeout(e,1500)),window.location.href="/"):mainFormError("data mismatch")}).catch(e=>{mainFormError(e)})}).catch(e=>{mainFormError(e)})}up_arrows.forEach(e=>{e.addEventListener("click",e=>{up_arrow_click(e)})}),down_arrows.forEach(e=>{e.addEventListener("click",e=>{down_arrow_click(e)})}),window.uploadForm=uploadForm;