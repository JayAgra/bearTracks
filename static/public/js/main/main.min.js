import{_get as e}from"../_modules/get/get.min.js";import{_post as t}from"../_modules/post/post.min.js";let API_META="/api/v1/data",API_MATCHES=["/api/v1/events/matches/","/","/qual/true"],API_WHOAMI="/api/v1/whoami",API_SUBMIT="/api/v1/data/submit";async function init(){e("/api/v1/whoami",null).then(e=>{console.info(e)}).catch(e=>{console.error(e),window.location.href="/login"}),await load_data(),document.getElementById("event_code").addEventListener("change",()=>{load_matches(document.getElementById("event_code").value)}),document.getElementById("match_num_input").addEventListener("change",()=>{match_num_entry(document.getElementById("match_num_input").value)})}async function load_data(){e("/api/v1/data",null).then(e=>{e.events.forEach(e=>{document.getElementById("event_code").insertAdjacentHTML("beforeend",`<option value="${e}">${e}</option>`)}),document.getElementById("event_code").value="CAFR",load_matches("CAFR")}).catch(e=>{alert(`failed to load valid event codes. ${e}`)})}function load_matches(t="CAFR"){e(API_MATCHES[0]+"2023"+API_MATCHES[1]+t+API_MATCHES[2],null).then(e=>{0!=e.Schedule.length?(match_schedule=e.Schedule,document.getElementById("match_num_input").innerHTML="",e.Schedule.forEach(e=>{document.getElementById("match_num_input").insertAdjacentHTML("beforeend",`<option value="${e.matchNumber}">${e.matchNumber}</option>`)}),match_num_entry("1")):(alert("match schedule is not yet posted"),document.getElementById("match_num_input").innerHTML="")}).catch(e=>{alert("match schedule is not yet posted"),document.getElementById("match_num_input").innerHTML=""})}function set_option(e,t){e.innerText=t,e.value=t}function match_num_entry(e){let t=Number(e),n=document.getElementsByClassName("teamNumOption");set_option(n[3],match_schedule[t-1].teams[0].teamNumber),set_option(n[4],match_schedule[t-1].teams[1].teamNumber),set_option(n[5],match_schedule[t-1].teams[2].teamNumber),set_option(n[0],match_schedule[t-1].teams[3].teamNumber),set_option(n[1],match_schedule[t-1].teams[4].teamNumber),set_option(n[2],match_schedule[t-1].teams[5].teamNumber)}document.body.onload=init;var match_schedule,timer_buttons=Array.from(document.getElementsByClassName("time_button")),timer_displays=Array.from(document.getElementsByClassName("counter")),timer_id=[0,0,0],timer_times=[0,0,0];function start_timer(e){timer_id[e]=setInterval(()=>{timer_times[e]+=.1,timer_displays[e].innerText=String(Math.round(10*timer_times[e])/10)},100)}function stop_timer(e){clearInterval(timer_id[e])}timer_buttons[0].addEventListener("mousedown",()=>{start_timer(0)}),timer_buttons[0].addEventListener("mouseup",()=>{stop_timer(0)}),timer_buttons[0].addEventListener("touchstart",()=>{start_timer(0)}),timer_buttons[0].addEventListener("touchend",()=>{stop_timer(0)}),timer_buttons[1].addEventListener("mousedown",()=>{start_timer(1)}),timer_buttons[1].addEventListener("mouseup",()=>{stop_timer(1)}),timer_buttons[1].addEventListener("touchstart",()=>{start_timer(1)}),timer_buttons[1].addEventListener("touchend",()=>{stop_timer(1)}),timer_buttons[2].addEventListener("mousedown",()=>{start_timer(2)}),timer_buttons[2].addEventListener("mouseup",()=>{stop_timer(2)}),timer_buttons[2].addEventListener("touchstart",()=>{start_timer(2)}),timer_buttons[2].addEventListener("touchend",()=>{stop_timer(2)}),document.addEventListener("mouseup",()=>{stop_timer(0),stop_timer(1),stop_timer(2)}),document.addEventListener("touchend",()=>{stop_timer(0),stop_timer(1),stop_timer(2)});var cycle_buttons=Array.from(document.getElementsByClassName("cycle_button")),cycle_data=[];function end_cycle(e){(0!=timer_times[0]||0!=timer_times[1]||0!=timer_times[2])&&(cycle_data.push({id:cycle_data.length,score_type:e,intake:Math.round(10*timer_times[0])/10,travel:Math.round(10*timer_times[1])/10,outtake:Math.round(10*timer_times[2])/10}),timer_times=[0,0,0],timer_displays.forEach(e=>{e.innerText="0"})),console.log(cycle_data)}function submit(){if(0==document.querySelector("[name=defense]").value.length||0==document.querySelector("[name=driving]").value.length||0==document.querySelector("[name=overall]").value.length||0==match_schedule.length||0==document.getElementById("match_num_input").value.length||0==document.getElementById("team_number").value.length)return;document.getElementById("form_content").style.display="none",document.getElementById("submit_page").style.display="block";var e=document.getElementById("submit_text"),n=document.getElementById("submit_progress"),a=document.getElementById("scout_again"),m=document.getElementById("success_seal"),i=document.getElementById("failure_seal");e.innerText="Submitting...",cycle_data.push({id:cycle_data.length,score_type:2,intake:Number(document.querySelector("[name=trap_note]").checked),travel:Number(document.querySelector("[name=trap_note]").checked),outtake:Number(document.querySelector("[name=trap_note]").checked)}),cycle_data.push({id:cycle_data.length,score_type:3,intake:Number(document.querySelector("[name=climb]").checked),travel:Number(document.querySelector("[name=climb]").checked),outtake:Number(document.querySelector("[name=climb]").checked)}),cycle_data.push({id:cycle_data.length,score_type:4,intake:Number(document.querySelector("[name=buddy_climb]").checked),travel:Number(document.querySelector("[name=buddy_climb]").checked),outtake:Number(document.querySelector("[name=buddy_climb]").checked)});let r={season:2024,event:document.getElementById("event_code").value,match_num:Number(document.getElementById("match_num_input").value),level:"Qualification",team:Number(document.getElementById("team_number").value),game:JSON.stringify(cycle_data),defend:document.querySelector("[name=defense]").value,driving:document.querySelector("[name=driving]").value,overall:document.querySelector("[name=overall]").value};t("/api/v1/data/submit",null,r).then(t=>{n.value=100,a.style.display="unset",m.style.display="unset",e.innerText="Submitted!"}).catch(t=>{n.value=0,i.style.display="unset",e.innerHTML=`Error!<br>${t}`})}cycle_buttons[0].addEventListener("click",()=>{end_cycle(0)}),cycle_buttons[1].addEventListener("click",()=>{end_cycle(1)}),document.getElementsByClassName("continue_button")[0].addEventListener("click",submit);